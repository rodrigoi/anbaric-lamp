<!doctype html>
<html>
  <head>
    <title>Anbaric Lamp</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="anbaric-lamp-vendor.js"></script>
    <script src="anbaric-lamp.js"></script>
    <style type="text/css">
      body {
        padding-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <a href="https://github.com/rodrigoi/anbaric-lamp"><img style="position: absolute; top: 0; right: 0; border: 0; z-index: 1040;" src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a>
    <div class="navbar navbar-inverse navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">Anbaric Lamp Demo</a>
        </div>
      </div>
    </div>
    <div id="content" class="container">
      <footer>
        <p>&copy; 2014</p>
      </footer>
    </div>
    <script id="item-template" type="text/x-handlebars-template">
      {{#each images}}
      <div class="row">
        <div class="col-lg-{{cols}}">
          <div class="well">
            <p class="text-center">source</p>
            <img class="center-block" src="{{image}}" />
          </div>
        </div>
        <div class="col-lg-{{cols}}">
          <div class="well">
            <p class="text-center">debug</p>
            <div></div>
          </div>
        </div>
      </div>
      <div class="performance"></div>
      <hr>
      {{/each}}
    </script>
    <script id="performance-template" type="text/x-handlebars-template">
      <div class="row">
        <div class="col-lg-12">
          <table class="table table-condensed">
            <tbody>
              {{#each details}}
              <tr>
                <td>{{step}}</td>
                <td>{{action}}</td>
                <td>{{time}}ms</td>
              </tr>
              {{/each}}
              <tr>
                <td colspan="2">Total Execution Time</td>
                <td>{{total}}ms</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </script>
    <script>
      window.onload = function (){

        var itemTemplate = Handlebars.compile(document.getElementById('item-template').textContent);
        var content = document.getElementById('content');

        var items = document.createElement('div');
        items.innerHTML = itemTemplate({
          images:[
            { cols:  6, image: 'images/douglas.png' },
            { cols:  6, image: 'images/doctor-quotes.png' },
            { cols:  6, image: 'images/kitty.jpg' },
            { cols:  6, image: 'images/snellen-chart.jpg' },
            { cols: 12, image: 'images/lullaby-white.jpg' },
            { cols: 12, image: 'images/lullaby-black.jpg' }
          ]});
        content.insertBefore(items, document.getElementsByTagName('footer'));


        var anbaricLamp = require('anbaric-lamp')['default'];

        var performanceTemplate = Handlebars.compile(document.getElementById('performance-template').textContent);

        var images = Array.prototype.slice.call(
          document.querySelectorAll('div.row img'));
        var debugContainers = Array.prototype.slice.call(
          document.querySelectorAll('div.well div'));
        var performanceContainers = Array.prototype.slice.call(
          document.querySelectorAll('div.performance'));

        images.forEach(function (image, index) {
          image.onload = function (){
            setTimeout(function (){
              var results = anbaricLamp(image, debugContainers[index]);
              performanceContainers[index].innerHTML = performanceTemplate(results.performance);
            }, 0);
          }
        });
      }
    </script>
  </body>

</html>
